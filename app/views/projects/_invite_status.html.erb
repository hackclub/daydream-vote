<%= turbo_frame_tag "invite_status" do %>
  <% if @pending_invites.any? %>
    <h2>Pending Invites</h2>
    <div class="invites-grid">
      <% @pending_invites.each do |invite| %>
        <div class="card light invite-card">
          <div class="invite-header">
            <h3><%= invite.project.title %></h3>
            <% unless invite.expired? %>
              <span class="invite-badge">Pending</span>
            <% else %>
              <span class="invite-badge expired">Expired</span>
            <% end %>
          </div>
          <div class="invite-info">
            <p><strong>Invited by:</strong> <%= invite.invited_by.email %></p>
            <p><strong>Expires:</strong> <%= invite.expires_at.strftime("%B %d, %Y at %I:%M %p") %></p>
          </div>
          <div class="invite-actions">
            <% unless invite.expired? %>
              <%= link_to "Accept Invite", accept_invite_path(invite.token), class: "submit-button-elem small", data: { turbo_frame: "_top" } %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p>No pending invites at this time.</p>
    <script>
      // Only poll when there are no invites
      setTimeout(() => {
        fetch('<%= projects_wait_for_invite_path %>', {
          headers: {
            'Turbo-Frame': 'invite_status',
            'Accept': 'text/html'
          }
        })
        .then(response => response.text())
        .then(html => {
          document.getElementById('invite_status').innerHTML = html;
        });
      }, 10000);
    </script>
  <% end %>

  <% if @accepted_projects.any? %>
    <h2>My Projects</h2>
    <div class="projects-grid">
      <% @accepted_projects.each do |project| %>
        <div class="card light game-card-wrapper">
          <div class="card light game-card">
            <div class="game-image">
              <% if project.image.attached? %>
                <%= image_tag project.image, class: "game-image-cover" %>
              <% end %>
            </div>
            <div class="game-info">
              <h3><%= project.title %></h3>
              <p><%= project.description %></p>
              <p class="game-byline">
                Role: <%= current_user.creator_positions.find_by(project: project).role.humanize %>
              </p>
            </div>
          </div>
          <div class="project-actions">
            <%= link_to "View Project", edit_project_path, class: "btn-small" %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p>You haven't joined any projects yet.</p>
  <% end %>
<% end %>
