<%# locals: (progress: nil) %>

<% stages = %i[your_info project_info invite_team review vote] %>
<% selected_stage_index = stages.index(progress) || 0 %>
<% current_stage_index = stages.index(current_user&.last_unlocked_step) || 0 %>

<nav class="progress-nav">
  <% if signed_in? && progress %>
    <div class="progress-container">
      <%= link_to edit_profile_path, class: "progress-step #{"active" if current_stage_index >= 0} #{"current" if selected_stage_index == 0}" do %>
        <div class="step-circle"></div>
        <div class="step-label">Your Info</div>
      <% end %>

      <div class="progress-line <%= "active" if current_stage_index >= 1 %>"></div>

      <%= link_to edit_project_path, class: "progress-step #{"active" if current_stage_index >= 1} #{"current" if selected_stage_index == 1}" do %>
        <div class="step-circle"></div>
        <div class="step-label">Game Info</div>
      <% end %>

      <div class="progress-line <%= "active" if current_stage_index >= 2 %>"></div>

      <%= link_to projects_invite_members_path, class: "progress-step #{"active" if current_stage_index >= 2} #{"current" if selected_stage_index == 2}" do %>
        <div class="step-circle"></div>
        <div class="step-label">Invite Team</div>
      <% end %>

      <div class="progress-line <%= "active" if current_stage_index >= 3 %>"></div>

      <%= link_to review_project_path, class: "progress-step #{"active" if current_stage_index >= 3} #{"current" if selected_stage_index == 3}" do %>
        <div class="step-circle"></div>
        <div class="step-label">Review & Submit</div>
        <img src="/shirt.png" class="navbar-shirt">
        <p class="navbar-shirt-arrow">v</p>
      <% end %>

      <div class="progress-line <%= "active" if current_stage_index >= 4 %>"></div>

      <% if current_user.projects.first&.attending_event && current_user.projects.first&.submitted? %>
        <%= link_to event_vote_path(current_user.projects.first.attending_event.name), class: "progress-step #{'active' if current_stage_index >= 4} #{'current' if selected_stage_index == 4}" do %>
          <div class="step-circle"></div>
          <div class="step-label">Vote</div>
        <% end %>
      <% else %>
        <div class="progress-step <%= "active" if current_stage_index >= 4 %> <%= "current" if selected_stage_index == 4 %>">
          <div class="step-circle"></div>
          <div class="step-label">Vote</span></div>
        </div>
      <% end %>
    </div>
  <% end %>
</nav>
